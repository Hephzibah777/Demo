<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Registration Form</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://kit.fontawesome.com/64d00f49f4.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="heading">
        <h1><b>EMPLOYEE'S REGISTRATION FORM</b></h1>
    </div>
    <div class="totaldiv"> <!--contains form and table-->
        <form id="myForm">
            <div class="maindiv"> <!--the main div which contains two paarts-->
                <div class="firstdiv"> <!--the first div is the register part-->

                    <div class="firstdetail">
                        <div><span class="ast">*</span>Indicates Required</div>

                        <h2>REGISTER HERE</h2>
                        <p class="para-field">
                            <input placeholder="Email*" name="email" class="inputs" id="email" type="email"
                                onfocus="highlightField(this)" onblur="validateEmail(this)">
                            <br>
                            <span id="email-error" class="error-message"></span>
                        </p>
                        <p class="para-field">
                            <input placeholder="Password*" id="password" name="password" type="password">
                            <span id="password-error" class="error-message"></span>
                        </p>

                        <div class="inputsec"><b><input type="checkbox" onclick="myFunction()" id="passwordcheck">Show
                                Password</b></div> <!--toggle password visibility-->
                        <div id="message">
                            <!-- the following message will be displayed when the password input field gets keyboards focus -->
                            <h3>Password must contain the following:</h3>
                            <p id="letter" class="invalid">A <b>lowercase</b> letter</p>
                            <p id="capital" class="invalid">A <b>capital (uppercase)</b> letter</p>
                            <p id="number" class="invalid">A <b>number</b></p>
                            <p id="length" class="invalid">Minimum <b>8 characters</b></p>
                        </div>
                        <p class="para-field">
                            <select name="country" id="country" class="inputs" onchange="populateCities()">
                                <option value="">Select Country*</option>
                                <br>
                            </select>

                            <span id="country-error" class="error-message"></span>
                        </p>
                        <p class="para-field">
                            <select name="city" id="city" class="inputs" onchange="populateAreas()">
                                <option value="">Select city*</option>
                                <br>
                            </select>
                            <span id="city-error" class="error-message"></span>
                        </p>
                        <p class="para-field">
                            <select name="area" id="area" class="inputs">
                                <option value="">Select Area*</option>
                                <br>
                            </select>
                            <span id="area-error" class="error-message"></span>
                        </p>
                        <p class="para-field">
                            <input placeholder="Pin Code*" onfocus="highlightField(this)"
                                onblur="nohighlightField(this)" name="pin" class="inputs" id="pin">
                            <span id="pin-error" class="error-message"></span>
                        </p>


                        <br>
                        <h2>QUALIFICATIONS : </h2>

                        <p class="para-field">
                            <select name="university" id="university" class="inputs">
                                <option value="Select University">Select University*</option>
                                <option value="XIM Univeristy">XIM University</option>
                                <option value="DY Patil">DY Patil</option>
                                <option value="MIT University">MIT University</option>
                            </select>
                            <span id="university-error" class="error-message"></span>
                        </p>

                        <p class="para-field">
                            <select name="qualification" id="qualification" class="inputs">
                                <option value="Highest Qualification">Highest Qualification*</option>
                                <option value="Phd">Phd</option>
                                <option value="Bacherlors">Bachelors</option>
                                <option value="Masters">Masters</option>
                            </select>
                            <span id="qualification-error" class="error-message"></span>
                        </p>

                        <p class="para-field">
                            <select name="grade" id="grade" class="inputs">
                                <option value="Grade Points">Grade Points*</option>
                                <option value="Above 9 CGPA">Above 9 CGPA</option>
                                <option value="Above 8 and Below 9">Above 8 and Below 9</option>
                                <option value="Below 8">Below 8</option>
                            </select>
                            <br>
                            <span id="grade-error" class="error-message"></span>
                        </p>
                    </div>
                </div>
                <div class="secondiv"> <!--the second div is the details part-->

                    <h2>YOUR DETAILS</h2>
                    <p class="para-field">
                        <input placeholder="First Name*" name="firstname" onfocus="highlightField(this)"
                            onblur="nohighlightField(this)" id="firstname" class="inputs">
                        <span id="firstname-error" class="error-message"></span>
                    </p>
                    <p class="para-field">
                        <input placeholder="Last Name*" name="lastname" onfocus="highlightField(this)"
                            onblur="nohighlightField(this)" id="lastname" class="inputs">
                        <span id="lastname-error" class="error-message"></span>
                    </p>
                    <span class="checks">
                        <label for="check" style="margin-right: 80px;"><b>Relocation*</b></label>
                        <label for="check"><b>YES</b></label>
                        <input type="checkbox" id="yes" name="yes" value="yes">
                        <label for="check"><b>NO</b></label>
                        <input type="checkbox" id="no" name="no" value="no">
                        <br>
                        <span id="radio-error" class="error-message"></span>
                    </span>

                    <p class="para-field">
                        <input placeholder="Phone Number*" name="phone" class="inputs" id="phone">
                        <span id="phone-error" class="error-message"></span>
                    </p>
                    <p class="para-field">
                        <input type="date" placeholder="dd-mm-yyyy" name="date" id="date" class="inputs">
                        <span id="date-error" class="error-message"></span>
                    </p>

                    <hr>
                    <h2 class="or">Or</h2>
                    <h1>AutoFill with Resume</h1>
                    <input type="file" id="myFile" name="filename" id="inputthird">


                </div>

                <button class="buttondetail" type="submit" id="buttondetail">Submit Application</button>
            </div>
        </form>


        <div class="table-div">
            <table id="myTable">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Phone Number</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Actions</th>
                    </tr>

                </thead>
                <tbody>
                    <!--dynamic rows will be updated here-->
                </tbody>
            </table>
        </div>
    </div>
    <div id="toastBox">
    </div>
    <!-- The Modal -->
    <div id="modal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Are you sure you want to delete this row?</p>
            <div class="options">
                <button class="optionbutton" id="yesoption">Yes</button>
                <button class="optionbutton" id="nooption">No</button>
            </div>
        </div>

    </div>

    <script>
        let editrow = null;
        let jsondata = null;
        let i = 0;



        // the below function works only when the validation is successfull, it adds the entries of the form in the table
        document.getElementById("myForm").addEventListener("submit", function (event) {
            event.preventDefault();
            //check whether the form is valid or not
            if (checkforvalidation(event) == true) {
                if (editrow != null) {
                    let tabledata = document.getElementById("myTable");
                    var tbody = tabledata.tBodies[0];
                    var row = tbody.rows[editrow.id];
                    row.cells[0].innerHTML = document.getElementById("email").value;
                    row.cells[1].innerHTML = document.getElementById("phone").value;
                    row.cells[2].innerHTML = document.getElementById("firstname").value;
                    row.cells[3].innerHTML = document.getElementById("lastname").value;
                    showToast('<i class="fa-solid fa-square-check"></i> Updated Successfully');

                    document.getElementById("buttondetail").textContent = "Submit Application";
                    editrow = null;
                }
                else {
                    let form = document.getElementById("myForm");
                    let yes = document.getElementById("yes");
                    let no = document.getElementById("no");
                    let formData = {};
                    for (let i = 0; i < form.elements.length; i++) {
                        let element = form.elements[i];
                        if (element.type != "submit" && element.type != "checkbox") {
                            formData[element.name] = element.value;
                        }
                        if (yes.checked) {
                            formData[yes.name] = yes.value;
                        }
                        if (no.checked) {
                            formData[no.name] = no.value;
                        }

                    }
                    formData.id = i;
                    i = i + 1;
                    const tablebody = document.querySelector("#myTable tbody");
                    const newRow = document.createElement("tr");
                    const emailCell = document.createElement("td");
                    emailCell.textContent = formData.email;

                    const phoneCell = document.createElement("td");
                    phoneCell.textContent = formData.phone;

                    const firstnameCell = document.createElement("td");
                    firstnameCell.textContent = formData.firstname;

                    const lastnameCell = document.createElement("td");
                    lastnameCell.textContent = formData.lastname;

                    newRow.appendChild(emailCell);
                    newRow.appendChild(phoneCell);
                    newRow.appendChild(firstnameCell);
                    newRow.appendChild(lastnameCell);


                    //create edit button for each newly added row
                    const editbutton = document.createElement("button");
                    editbutton.textContent = "Edit";
                    editbutton.classList.add("button-edit");
                    editbutton.addEventListener("click", function () {
                        handleEdit(formData);
                    });

                    //create delete button for each newly added row
                    const deletebutton = document.createElement("button");
                    deletebutton.textContent = "Delete";
                    deletebutton.classList.add("button-delete");
                    deletebutton.addEventListener("click", function () {
                        handleDelete(formData);
                    });

                    const commonbutton = document.createElement("td");
                    commonbutton.classList.add("buttons");
                    commonbutton.append(editbutton, deletebutton);

                    newRow.appendChild(commonbutton);
                    tablebody.append(newRow);

                    document.getElementById("myForm").reset();
                    showToast('<i class="fa-solid fa-square-check"></i> Submitted Successfully');
                }
            }

        });

        const data = {
            "USA": {
                "New York": ["Manhattan", "Brooklyn", "Queens"],
                "California": ["Los Angeles", "San Francisco", "San Diego"]
            },
            "India": {
                "Maharashtra": ["Mumbai", "Pune", "Nagpur"],
                "Delhi": ["South Delhi", "North Delhi", "West Delhi"]
            }
        };

        //handle edit button action
        function handleEdit(row) {
            console.log(row);
            document.getElementById("email").value = row.email;
            document.getElementById("country").value = row.country;
            document.getElementById("city").value = row.city;
            document.getElementById("area").value = row.area;
            document.getElementById("firstname").value = row.firstname;
            document.getElementById("lastname").value = row.lastname;
            document.getElementById("pin").value = row.pin;
            document.getElementById("phone").value = row.phone;
            document.getElementById("university").value = row.university;
            document.getElementById("qualification").value = row.qualification;
            document.getElementById("grade").value = row.grade;
            document.getElementById("date").value = row.date;
            if ("yes" in row) {
                document.getElementById("yes").checked = true;
            }
            if ("no" in row) {
                document.getElementById("no").checked = true;
            }

            document.getElementById("buttondetail").textContent = "Update";
            editrow = row;

        }

        //handle delete button action
        function handleDelete(row) {
            var modal = document.getElementById("modal");
            modal.style.display = "block";
            var span = document.getElementsByClassName("close")[0];
            var yes = document.getElementById("yesoption");
            var no = document.getElementById("nooption");
            // When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = "none";
            }
            no.onclick = function () {
                modal.style.display = "none";
            }
            yes.onclick = function () {
                  
                let tabledata = document.getElementById("myTable");
                var tbody = tabledata.tBodies[0];
                var deleterowid = row.id;

                tbody.deleteRow(deleterowid);
                showToast('<i class="fa-solid fa-trash"></i> Deleted Successfully');
                modal.style.display = "none";
            
            }

           

        }

        // Populate country dropdown on page load
        window.onload = function () {
            const countrySelect = document.getElementById('country');
            for (let country in data) {
                let option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
            }
        };

        // Populate cities based on selected country
        function populateCities() {
            const countrySelect = document.getElementById('country');
            const citySelect = document.getElementById('city');
            const areaSelect = document.getElementById('area');
            const selectedCountry = countrySelect.value;

            // Clear existing options
            citySelect.innerHTML = '<option value="">Select City</option>';
            areaSelect.innerHTML = '<option value="">Select Area</option>';

            if (selectedCountry) {
                const cities = Object.keys(data[selectedCountry]);
                cities.forEach(city => {
                    let option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            }
        }

        // Populate areas based on selected city
        function populateAreas() {
            const countrySelect = document.getElementById('country');
            const citySelect = document.getElementById('city');
            const areaSelect = document.getElementById('area');
            const selectedCountry = countrySelect.value;
            const selectedCity = citySelect.value;

            // Clear existing options
            areaSelect.innerHTML = '<option value="">Select Area</option>';

            if (selectedCountry && selectedCity) {
                const areas = data[selectedCountry][selectedCity];
                areas.forEach(area => {
                    let option = document.createElement('option');
                    option.value = area;
                    option.textContent = area;
                    areaSelect.appendChild(option);
                });
            }
        }


        function highlightField(field) {
            field.style.backgroundColor = "grey";
        }
        function nohighlightField(field) {
            field.style.backgroundColor = "";
        }

        //validate email while the user is typing
        function validateEmail(field) {
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!emailRegex.test(field.value)) {
                field.style.borderColor = "red";
                document.getElementById("email-error").textContent = "Please enter a valid email address";
            }
            else {
                field.style.borderColor = "green";
                document.getElementById("email-error").textContent = "";
            }
            field.style.backgroundColor = "";
        }

        
        //Empty fields validation manually
        const form = document.getElementById("myForm");

        function checkforvalidation(e) {
            e.preventDefault();
            var email = document.getElementById("email").value;
            var password = document.getElementById("password").value;
            var country = document.getElementById("country").value;
            var city = document.getElementById("city").value;
            var area = document.getElementById("area").value;
            var pin = document.getElementById("pin").value;
            var university = document.getElementById("university").value;
            var qualification = document.getElementById("qualification").value;
            var grade = document.getElementById("grade").value;
            var phone = document.getElementById("phone").value;
            var date = document.getElementById("date").value;
            var firstname = document.getElementById("firstname").value;
            var lastname = document.getElementById("lastname").value;
            var yes = document.getElementById("yes").value;
            var no = document.getElementById("no").value;


            let isValid = true;
            document.getElementById("email-error").textContent = "";
            document.getElementById("password-error").textContent = "";
            document.getElementById("country-error").textContent = "";
            document.getElementById("city-error").textContent = "";
            document.getElementById("area-error").textContent = "";
            document.getElementById("pin-error").textContent = "";
            document.getElementById("university-error").textContent = "";
            document.getElementById("qualification-error").textContent = "";
            document.getElementById("grade-error").textContent = "";
            document.getElementById("firstname-error").textContent = "";
            document.getElementById("lastname-error").textContent = "";
            document.getElementById("phone-error").textContent = "";
            document.getElementById("radio-error").textContent = "";
            document.getElementById("date-error").textContent = "";


            const emailRegex = /^([a-zA-Z0-9._%+-]+)@([a-zA-Z0-9.-]+)\.([a-zA-Z]{2,})$/;
            if (email == "") {
                document.getElementById("email-error").textContent = "Invalid email address.";
                isValid = false;
            }


            if (password == "") {
                document.getElementById("password-error").textContent = "Password field is missing";
                isValid = false;
            }


            const countryRegex = /^[a-zA-Z]{1,10}$/;
            if (country == "") {
                document.getElementById("country-error").textContent = "Country field is missing";
                isValid = false;
            }
            if (city == "") {
                document.getElementById("city-error").textContent = "City field is missing ";
                isValid = false;
            }
            if (area == "") {
                document.getElementById("area-error").textContent = "Area field is missing";
                isValid = false;
            }
            const pinRegex = /^\d$/;
            if (pin == "") {
                document.getElementById("pin-error").textContent = "Pin must  contain only numbers";
                isValid = false;
            }
            if (university == "") {
                document.getElementById("university-error").textContent = "University is not selected";
                isValid = false;
            }
            if (qualification == "") {
                document.getElementById("qualification-error").textContent = "Qualification is not selected";
                isValid = false;
            }
            if (grade == "") {
                document.getElementById("grade-error").textContent = "Grade is not selected";
                isValid = false;
            }
            if (firstname == "") {
                document.getElementById("firstname-error").textContent = "First Name field is missing";
                isValid = false;
            }
            if (lastname == "") {
                document.getElementById("lastname-error").textContent = "Last Name field is missing";
                isValid = false;
            }
            const phoneRegex = /^[7-9][0-9]{9}$/;
            if (phone == "") {
                document.getElementById("phone-error").textContent =
                    "Phone number is missing";
                isValid = false;
            }
            if (yes == "" && no == "") {
                document.getElementById("radio-error").textContent = "Relocation is not selected";
                isValid = false;
            }
            if (date == "") {
                document.getElementById("date-error").textContent = "Date is not selected";
                isValid = false;
            }


            if (isValid == true) {

                return true;
            }
            else {
                showToast('<i class="fa-solid fa-circle-exclamation"></i> Invalid Input');
            }

        }
        function showToast(msg) {
            let toastBox = document.getElementById("toastBox");
            let toast = document.createElement("div");
            toast.classList.add("toast");
            toast.innerHTML = msg;
            toastBox.appendChild(toast);

            if (msg.includes('Invalid')) {
                toast.classList.add('invalid');
            }

            setTimeout(() => {
                toast.remove();
            }, 6000);

        }
        // password toggle visibility
        function myFunction() {
            var temp = document.getElementById("passwordcheck");
            var myInput = document.getElementById("password");
            if (myInput.type === "password") {
                myInput.type = "text";
            }
            else {
                myInput = "password";
            }


        }
        //password validation
        var myInput = document.getElementById("password");
        var letter = document.getElementById("letter");
        var capital = document.getElementById("capital");
        var number = document.getElementById("number");
        var length = document.getElementById("length");
        var message = document.getElementById("message");

        myInput.onfocus = function () {
            message.style.display = "block";
        }
        myInput.onblur = function () {
            message.style.display = "none";
        }
        // When the user starts to type something inside the password field
        myInput.onkeyup = function () {
            // Validate lowercase letters
            var lowerCaseLetters = /[a-z]/g;
            if (myInput.value.match(lowerCaseLetters)) {
                letter.classList.remove("invalid");
                letter.classList.add("valid");
            } else {
                letter.classList.remove("valid");
                letter.classList.add("invalid");
            }

            // Validate capital letters
            var upperCaseLetters = /[A-Z]/g;
            if (myInput.value.match(upperCaseLetters)) {
                capital.classList.remove("invalid");
                capital.classList.add("valid");
            } else {
                capital.classList.remove("valid");
                capital.classList.add("invalid");
            }

            // Validate numbers
            var numbers = /[0-9]/g;
            if (myInput.value.match(numbers)) {
                number.classList.remove("invalid");
                number.classList.add("valid");
            } else {
                number.classList.remove("valid");
                number.classList.add("invalid");
            }

            // Validate length
            if (myInput.value.length >= 8) {
                length.classList.remove("invalid");
                length.classList.add("valid");
            } else {
                length.classList.remove("valid");
                length.classList.add("invalid");
            }

        }
    </script>
</body>

</html>
